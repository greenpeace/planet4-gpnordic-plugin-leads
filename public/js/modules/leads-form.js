"use strict";!function(o){function n(e){e=jQuery(e).hasClass("leads-form")?"#"+e.attr("id"):e[0].children[0];var t=window["leads_form_"+jQuery(e).attr("data-block-id")];new Vue({el:e,data:{formId:jQuery(e).attr("data-form-id"),blockData:t,targetCounter:+t.counter,goal:t.counterGoalValue,loading:!1,donateAmount:t.donateAmount,donateAmountInputValue:null,presetDonateAmount:0,errors:[],emailErrors:[],firstNameErrors:[],lastNameErrors:[],phoneErrors:[],otherErrors:[],success:!1,formFields:t.formFields,showThankYouAnimation:!1,animationSpeed:.6,heroDescription:t.heroDescription,textLimit:300,textOpen:!1,display:t.display,heroTitle:t.heroTitle,hideInput:"collapse"==t.formStyle,dataLayer:window.dataLayer,sourceCode:t.sourceCode,startedFilling:!1,formType:t.formType,multistepCount:t.multistepCount,multistepActive:0,multistepCompleted:[],multistepViewed:[],finalData:t.finalData,steps:t.steps},computed:{percentReachedGoal:function(){return Math.min(+this.targetCounter/+this.goal*100,100)},reachedGoal:function(){return this.targetCounter>=this.goal},thankYouTitle:function(){return this.parseVariables(t.thankYouTitle)},thankYouDescription:function(){return this.parseVariables(t.thankYouDescription)},hasErrors:function(){return 0<this.errors.length},moreButtonText:function(){return this.textOpen?t.readLess:t.readMore},showReadMore:function(){return this.heroDescription.length>=this.textLimit},completedAllAsks:function(){return this.multistepCompleted.length===this.multistepCount-2},isLocalEnv:function(){return"www.planet4.test"===o(location).attr("hostname")||"greenpeace.local"===o(location).attr("hostname")}},watch:{startedFilling:function(){this.dataLayer&&this.dataLayer.push({event:"petitionFilling"})}},mounted:function(){var e,t=this;"multistep"!==this.formType&&(this.donateAmountInputValue=this.donateAmount),this.dataLayer&&this.dataLayer.push({sourceCode:this.sourceCode,counter:this.blockData.enableCounter?"yes":"no"}),gsap.timeline({}).from(".leads-form__content",{y:100,opacity:0,duration:this.animationSpeed}).from(".leads-form__main-container",{y:100,opacity:0,duration:this.animationSpeed},"-="+this.animationSpeed/2),this.blockData.enableCounter&&Array.isArray(this.blockData.counterApiEndpoints)&&(e="",e=this.isLocalEnv?"/wp-json/gplp/v2/leads/count/"+this.sourceCode+"?v="+Date.now():"/"+window.location.pathname.split("/")[1]+"/wp-json/gplp/v2/leads/count/"+this.sourceCode+"?v="+Date.now(),jQuery.get(e,function(e){t.targetCounter=+e.counter,t.blockData.counterApiEndpoints.forEach(function(e){e&&""!==jQuery.trim(e)&&void 0!==e&&jQuery.get(e,t.formFields,function(e){t.targetCounter=t.targetCounter+ +e.counter,t.animateCounter()})}),0==t.blockData.counterApiEndpoints.length&&t.animateCounter()}))},methods:{parseVariables:function(e){var o={email:this.formFields.email.value,fname:this.formFields.fname.value,counterCurrent:this.targetCounter,counterGoal:this.goal};return e.replace(/\${(.*?)}/g,function(e,t){return o[t]})},animateCounter:lodash.debounce(function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this,t={val:e.counter},o=e.targetCounter;TweenLite.to(t,2,{val:o,roundProps:"val",onUpdate:function(){e.counter=t.val}})},1e3),setPreset:function(e){this.presetDonateAmount=e,this.donateAmount=null,this.donateAmountInputValue=null},setDonateAmount:function(e){this.donateAmountInputValue=e.target.value,this.donateAmount=e.target.value},getDonateUrl:function(e){var t=this.donateAmount&&0<this.donateAmount?this.donateAmount:this.presetDonateAmount;return e.replace("%amount%",t)},hasFieldErrors:function(e){return 0<(""+e).length},pushMessage:function(e,t){("email"==e?this.emailErrors:"fname"==e?this.firstNameErrors:"lname"==e?this.lastNameErrors:"phone"==e?this.phoneErrors:this.otherErrors).push(t),"small"==this.display&&"phone"==e||this.errors.push(t)},addBlur:function(){var e=this;window.setTimeout(function(){e.$refs.bkg.classList.add("blur"),e.$refs.smallBkg&&e.$refs.smallBkg.classList.add("blur")},800)},numbersOnly:function(e){var t=void 0===e.which?e.keyCode:e.which;String.fromCharCode(t).match(/^[0-9]+$/)||e.preventDefault()},checkMinVal:function(e){e.target.value=Math.max(+e.target.value,this.blockData.donateMinimumAmount)},submit:function(){var e,n=this;if(!this.loading)return this.hideInput=!1,this.errors=[],this.emailErrors=[],this.firstNameErrors=[],this.lastNameErrors=[],this.phoneErrors=[],this.otherErrors=[],Object.keys(this.formFields).forEach(function(e){return""==n.formFields[e].value&&n.formFields[e].required&&n.pushMessage(n.formFields[e].id,t.errorMessages.required.replace("${fieldName}",n.formFields[e].fieldName))}),Object.keys(this.formFields).forEach(function(e){""===n.formFields[e].value||""===n.formFields[e].regex||n.formFields[e].regex.test(n.formFields[e].value)||("phone"===e?n.pushMessage(n.formFields[e].id,n.blockData.errorMessages.phoneFormat):n.pushMessage(n.formFields[e].id,n.blockData.errorMessages.format.replace("${fieldName}",n.formFields[e].fieldName)))}),this.dataLayer&&this.dataLayer.push({event:"errorMessage",errorMessageEmail:this.emailErrors[0],errorMessageFirstName:this.firstNameErrors[0],errorMessageLastName:this.lastNameErrors[0],errorMessagePhone:this.phoneErrors[0],errorMessageOther:this.otherErrors[0]}),0==this.errors.length&&(this.loading=!0,e="",e=this.isLocalEnv?"/wp-json/gplp/v2/leads":window.location.origin+"/"+window.location.pathname.split("/")[1]+"/wp-json/gplp/v2/leads",jQuery.post(e,this.formFields,function(e){n.loading=!1,n.targetCounter=n.targetCounter+1,n.dataLayer&&n.dataLayer.push({event:"petitionSignup",gGoal:"Petition Signup",gConsent:n.formFields.consent.value?"optIn":"optOut",gEmail:n.formFields.email.value,gPhone:n.formFields.phone.value?"withPhone":"withoutPhone"}),"multistep"===n.formType?(gsap.timeline({}).to(".leads-form__multistep__container",{y:100,opacity:0,duration:n.animationSpeed,onComplete:function(){return n.success=!0}}).to(".leads-form__multistep__container",{y:0,opacity:1,duration:n.animationSpeed}),n.pushDataLayer("thank_you")):gsap.timeline({onComplete:function(){jQuery.ajax({url:t.pluginUrl+"bower_components/bodymovin/build/player/lottie_light.min.js",dataType:"script"}).then(function(){n.showThankYouAnimation=!0;var e=jQuery('[id*="leads-form-block_"]').map(function(){return this.id}).get();document.querySelector("#"+e[0]).scrollIntoView(),lottie.loadAnimation({container:n.$refs.animation,renderer:"svg",loop:!1,autoplay:!0,path:t.pluginUrl+"public/json/thank-you.json"}).addEventListener("complete",function(){n.success=!0,n.showThankYouAnimation=!1,Vue.nextTick(function(){gsap.timeline({}).from(".leads-form__thank-you",{y:100,opacity:0,duration:n.animationSpeed}).from(".leads-form__counter",{y:100,opacity:0,duration:n.animationSpeed},"-="+n.animationSpeed/2).from(".leads-form__share",{y:100,opacity:0,duration:n.animationSpeed},"-="+n.animationSpeed/2).from(".leads-form__donate",{y:100,opacity:0,duration:n.animationSpeed,onComplete:n.addBlur()},"-="+n.animationSpeed/2)});var e=document.querySelector("#donate-container").querySelectorAll(".donation-options")[0].className.split(" ")[0],t=document.getElementById("donate-button");switch(e){case"ghost":n.dataLayer&&n.dataLayer.push({event:"petitionThankYou",sourceCode:n.sourceCode,phone:n.formFields.phone.value,flow:"single-step-flow",donationOption:"predefined link to donation"});var o=n.donateAmount;t.addEventListener("click",function(){n.dataLayer&&n.dataLayer.push({event:"petitionDonation",PetitionDonationLink:"predefined amount to donation",amount:o,flow:"single-step-flow"})});break;case"button--submit":n.dataLayer&&n.dataLayer.push({event:"petitionThankYou",donationOption:"direct link to donation",flow:"single-step-flow"}),t.addEventListener("click",function(){n.dataLayer&&n.dataLayer.push({event:"petitionDonation",PetitionDonationLink:"direct link to choose amount",flow:"single-step-flow"})});break;default:console.log("Nada.")}document.getElementById("facebook").addEventListener("click",function(){n.dataLayer&&n.dataLayer.push({event:"uaevent",eventAction:"Facebook",eventCategory:"Social Share"})})})})}}).to(".leads-form__content",{y:100,opacity:0,duration:n.animationSpeed}).to(".leads-form__form",{y:100,opacity:0,duration:n.animationSpeed},"-="+n.animationSpeed/2)}).fail(function(e){n.errors.push(e.responseJSON.message),n.otherErrors.push(e.responseJSON.message),n.loading=!1})),!1},limitedText:function(e,t){return e.length>=this.textLimit&&!t?e.substring(0,this.textLimit)+"...":e},lengthClass:function(e){return e.length<10?"under-10":e.length<20?"under-20":e.length<25?"under-25":e.length<30?"under-30":e.length<35?"under-35":e.length<45?"under-45":e.length<60?"under-60":e.length<85?"under-85":95<e.length?"over-95":""},toggleText:function(){var e=this;(new gsap.timeline).to(this.$refs.heroDescription,{opacity:0,duration:.2,onComplete:function(){return e.textOpen=!e.textOpen}}).to(this.$refs.heroDescription,{opacity:1,duration:.25})},copyLink:function(e){var t=this,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0,n=document.createElement("input"),i="";switch(window.location.pathname.split("/")[1]){case"denmark":i="Link kopieret!";break;case"finland":i="Linkki kopioitu!";break;case"norway":i="Lenke kopiert!";break;case"sweden":i="LÃ¤nk kopierad!";break;default:i="Link Copied!"}document.body.appendChild(n),n.value=e,n.select(),document.execCommand("copy"),document.body.removeChild(n),document.querySelector("#copy-link").innerHTML=i,this.pushDataLayer("action_share","Copy link"),o&&setTimeout(function(){t.completeMultistep(o)},1e3)},pushDataLayer:function(e,t){if(e){var o={};switch(e){case"thank_you":o={event:"petitionThankYou",sourceCode:this.sourceCode,phone:this.formFields.phone.value,flow:"multi-step-flow",stepName:"intro"};break;case"thank_you_yes":o={event:"petitionTYButton",buttonName:"yes"};break;case"thank_you_no":o={event:"petitionTYButton",buttonName:"no"};break;case"share":o={event:"petitionThankYou",sourceCode:this.sourceCode,stepName:"share"};break;case"action_share":o={event:"uaEvent",eventAction:t,eventCategory:"Social share"};break;case"donation":o={event:"petitionThankYou",sourceCode:this.sourceCode,stepName:"donationOptions"};break;case"action_donation":o={event:"petitionDonation",PetitionDonationLink:this.donateAmount&&0<this.donateAmount?null===this.donateAmountInputValue?"direct link to donation":"custom amount to donation":"predefined amount to donation",amount:this.donateAmount&&0<this.donateAmount?this.donateAmount:this.presetDonateAmount};break;case"custom_ask":o={event:"petitionThankYou",sourceCode:this.sourceCode,stepName:"custom step",stepText:"{"+this.toKebabCase(t)+"}"};break;case"action_custom_ask":o={event:"customAsk",label:t};break;case"final":o={event:"petitionThankYou",sourceCode:this.sourceCode,stepName:"finalStep",stepCompleted:this.multistepCompleted.length+1+"/"+(this.multistepCount-1)};break;case"action_final":o={event:"checkCampaigns"};break;case"skip_step":o={event:"skipStep"}}this.dataLayer&&this.dataLayer.push(o)}},goToStep:function(e){this.multistepActive=e;var t=this.steps.step&&this.steps.step[this.multistepActive-1]?this.steps.step[this.multistepActive-1].select_step:this.multistepActive===this.steps.step.length+1?"final":null,o=null;"custom_ask"===t&&(o=this.steps.custom_ask_headline),this.pushDataLayer(t,o),this.multistepViewed.includes(e)||this.multistepViewed.push(e)},disagreeToShare:function(e,t){this.multistepViewed.push(e),this.goToStep(t)},wasCompleted:function(e){return this.multistepCompleted.includes(e)},wasSkipped:function(e){return this.multistepViewed.includes(e)&&!this.multistepCompleted.includes(e)&&this.multistepActive!==e},completeMultistep:function(e){this.multistepCompleted.includes(e)||this.multistepCompleted.push(e),this.nextStep()},prevStep:function(){0<this.multistepActive&&this.goToStep(this.multistepActive-1)},nextStep:function(){this.multistepActive<this.multistepCount&&this.goToStep(this.multistepActive+1)},isFirst:function(e){return e<=0},isLast:function(e){return e>=this.multistepCount-1},toKebabCase:function(e){return e&&e.match(/[A-Z]{2,}(?=[A-Z][a-z]+[0-9]*|\b)|[A-Z]?[a-z]+[0-9]*|[A-Z]|[0-9]+/g).map(function(e){return e.toLowerCase()}).join("-")}}})}document.addEventListener("DOMContentLoaded",function(){0<jQuery(".leads-form").length&&o(".leads-form").each(function(e,t){n(o(t))})}),window.acf&&window.acf.addAction("render_block_preview/type=leads-form",function(e){window.setTimeout(n(e),2e3)})}(jQuery);